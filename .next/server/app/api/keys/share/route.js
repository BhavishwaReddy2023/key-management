"use strict";(()=>{var a={};a.id=154,a.ids=[154,652],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4985:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>O,patchFetch:()=>N,routeModule:()=>J,serverHooks:()=>M,workAsyncStorage:()=>K,workUnitAsyncStorage:()=>L});var d={};c.r(d),c.d(d,{DELETE:()=>I,GET:()=>G,POST:()=>H});var e=c(96559),f=c(48088),g=c(37719),h=c(26191),i=c(81289),j=c(261),k=c(92603),l=c(39893),m=c(14823),n=c(47220),o=c(66946),p=c(47912),q=c(99786),r=c(46143),s=c(86439),t=c(43365),u=c(32190),v=c(19854),w=c(28293),x=c(93834),y=c(56037),z=c.n(y);let A=new(z()).Schema({keyId:{type:z().Schema.Types.ObjectId,ref:"Key",required:!0},sharedBy:{type:z().Schema.Types.ObjectId,ref:"User",required:!0},sharedWith:{type:z().Schema.Types.ObjectId,ref:"User",required:!0},sharedDate:{type:Date,default:Date.now},expiresAt:{type:Date,required:!0},duration:{type:String,required:!0},message:{type:String,trim:!0},status:{type:String,enum:["active","expired","revoked","cancelled"],default:"active"},accessCount:{type:Number,default:0},lastAccessed:{type:Date},revokedAt:{type:Date},revokedBy:{type:z().Schema.Types.ObjectId,ref:"User"},revocationReason:{type:String},cancelledAt:{type:Date},cancelledBy:{type:z().Schema.Types.ObjectId,ref:"User"},cancellationReason:{type:String},notificationsSent:{type:Number,default:0},lastNotificationSent:{type:Date},permissions:{canCollect:{type:Boolean,default:!0},canReturn:{type:Boolean,default:!0},canDelegate:{type:Boolean,default:!1}}},{timestamps:!0});A.index({sharedBy:1,status:1}),A.index({sharedWith:1,status:1}),A.index({keyId:1,status:1}),A.index({expiresAt:1,status:1}),A.virtual("isExpired").get(function(){return"active"===this.status&&new Date>this.expiresAt}),A.virtual("timeRemaining").get(function(){if("active"!==this.status)return null;let a=new Date,b=this.expiresAt-a;if(b<=0)return"Expired";let c=Math.floor(b/36e5),d=Math.floor(b%36e5/6e4);return c>0?`${c}h ${d}m`:`${d}m`}),A.virtual("durationInHours").get(function(){return Math.ceil((this.expiresAt-this.sharedDate)/36e5)}),A.methods.recordAccess=function(){return this.accessCount+=1,this.lastAccessed=new Date,this.save()},A.methods.revoke=function(a,b=""){return this.status="revoked",this.revokedAt=new Date,this.revokedBy=a,this.revocationReason=b,this.save()},A.methods.cancel=function(a,b=""){return this.status="cancelled",this.cancelledAt=new Date,this.cancelledBy=a,this.cancellationReason=b,this.save()},A.methods.extend=function(a){if("active"!==this.status)throw Error("Cannot extend inactive sharing");let b=new Date(this.expiresAt.getTime()+60*a*6e4);this.expiresAt=b;let c=this.durationInHours+a;return this.duration=`${c} hours`,this.save()},A.methods.sendNotification=async function(a="reminder"){this.notificationsSent+=1,this.lastNotificationSent=new Date,await this.save(),console.log(`Notification sent for sharing ${this._id}: ${a}`)},A.statics.findActive=function(){return this.find({status:"active",expiresAt:{$gt:new Date}}).populate("keyId sharedBy sharedWith")},A.statics.findExpired=function(){return this.find({status:"active",expiresAt:{$lte:new Date}}).populate("keyId sharedBy sharedWith")},A.statics.findByUser=function(a,b="all"){let c={};switch(b){case"shared_by":c.sharedBy=a;break;case"shared_with":c.sharedWith=a;break;default:c.$or=[{sharedBy:a},{sharedWith:a}]}return this.find(c).populate("keyId","name labName labNumber").populate("sharedBy","name email").populate("sharedWith","name email").sort({sharedDate:-1})},A.statics.getKeyShares=function(a){return this.find({keyId:a,status:"active"}).populate("sharedBy","name email").populate("sharedWith","name email").sort({sharedDate:-1})},A.statics.getSharingStats=function(a,b){return this.aggregate([{$match:{sharedDate:{$gte:a,$lte:b}}},{$group:{_id:{date:{$dateToString:{format:"%Y-%m-%d",date:"$sharedDate"}},status:"$status"},count:{$sum:1},totalAccessCount:{$sum:"$accessCount"}}},{$group:{_id:"$_id.date",statuses:{$push:{status:"$_id.status",count:"$count",totalAccess:"$totalAccessCount"}},totalShares:{$sum:"$count"}}},{$sort:{_id:1}}])},A.pre("save",function(a){"active"===this.status&&new Date>this.expiresAt&&(this.status="expired"),a()}),A.post("save",async function(a){if(a.isNew){let b=z().model("KeyTransaction");await b.create({type:"shared",keyId:a.keyId,facultyId:a.sharedBy,sharedWith:a.sharedWith,sharedDuration:a.duration,sharingMessage:a.message,details:`Key shared for ${a.duration}`})}}),A.statics.cleanupExpired=async function(){let a=await this.find({status:"active",expiresAt:{$lte:new Date}});for(let b of a)b.status="expired",await b.save();return a.length};let B=z().models.KeySharing||z().model("KeySharing",A);var C=c(86789),D=c(75210),E=c(37652),F=c(92729);async function G(a){try{let b=await (0,v.getServerSession)(w.authOptions);if(!b)return u.NextResponse.json({error:"Unauthorized"},{status:401});await (0,x.connectDB)();let{searchParams:c}=new URL(a.url),d=c.get("type"),e=b.user.id;switch(d){case"faculty-list":let f=(await E.default.find({role:"faculty",department:b.user.department,_id:{$ne:e},isActive:!0}).select("name email department")).map(a=>({id:a._id,name:a.name,email:a.email,department:a.department}));return u.NextResponse.json({faculty:f});case"my-shares":let g=(await B.find({sharedBy:e,status:"active"}).populate("keyId","name labName labNumber").populate("sharedWith","name email")).map(a=>({id:a._id,keyName:a.keyId.name,labName:a.keyId.labName,recipient:a.sharedWith.name,recipientEmail:a.sharedWith.email,sharedDate:a.sharedDate,expiresAt:a.expiresAt,duration:a.duration,message:a.message}));return u.NextResponse.json({shares:g});case"received-shares":let h=(await B.find({sharedWith:e,status:"active"}).populate("keyId","name labName labNumber").populate("sharedBy","name email")).map(a=>({id:a._id,keyName:a.keyId.name,labName:a.keyId.labName,sharedBy:a.sharedBy.name,sharedByEmail:a.sharedBy.email,sharedDate:a.sharedDate,expiresAt:a.expiresAt,duration:a.duration,message:a.message}));return u.NextResponse.json({received:h});default:return u.NextResponse.json({error:"Invalid type parameter"},{status:400})}}catch(a){return console.error("Error fetching sharing data:",a),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function H(a){try{let b=await (0,v.getServerSession)(w.authOptions);if(!b)return u.NextResponse.json({error:"Unauthorized"},{status:401});let{action:d,data:e}=await a.json();switch(await (0,x.connectDB)(),d){case"share-key":if(!await C.A.findOne({keyId:e.keyId,facultyId:b.user.id,status:"active"}))return u.NextResponse.json({error:"You do not have access to this key"},{status:403});let f=e.recipientId;if(!c(56037).Types.ObjectId.isValid(e.recipientId)){let a=await E.default.findOne({employeeId:e.recipientId});if(!a)return u.NextResponse.json({error:"Recipient user not found"},{status:404});f=a._id}if(await B.findOne({keyId:e.keyId,sharedBy:b.user.id,sharedWith:f,status:"active"}))return u.NextResponse.json({error:"Key is already shared with this person"},{status:400});let g=parseInt(e.duration),h=new Date(Date.now()+60*g*6e4),i=new B({keyId:e.keyId,sharedBy:b.user.id,sharedWith:f,sharedDate:new Date,expiresAt:h,duration:`${g} hours`,message:e.message,status:"active"});await i.save();let j=new D.A({type:"shared",keyId:e.keyId,facultyId:b.user.id,timestamp:new Date,details:`Key shared with ${e.recipientName} for ${g} hours`,status:"completed",sharedWith:f,sharedDuration:`${g} hours`});await j.save();let k=await E.default.findById(f);return k&&await F.A.sendKeyAssignmentNotification(k.email,{facultyName:k.name,keyName:e.keyName,labName:e.labName,accessType:"shared",assignedDate:new Date().toLocaleDateString()}),u.NextResponse.json({message:"Key shared successfully",sharingId:i._id});case"revoke-share":let l=await B.findOne({_id:e.sharingId,sharedBy:b.user.id,status:"active"});if(!l)return u.NextResponse.json({error:"Sharing record not found"},{status:404});l.status="revoked",l.revokedAt=new Date,await l.save();let m=new D.A({type:"share_revoked",keyId:l.keyId,facultyId:b.user.id,timestamp:new Date,details:"Key sharing access revoked",status:"completed"});return await m.save(),u.NextResponse.json({message:"Key sharing revoked successfully"});default:return u.NextResponse.json({error:"Invalid action"},{status:400})}}catch(a){return console.error("Error processing sharing request:",a),u.NextResponse.json({error:"Internal server error"},{status:500})}}async function I(a){try{let b=await (0,v.getServerSession)(w.authOptions);if(!b)return u.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:c}=new URL(a.url),d=c.get("id");await (0,x.connectDB)();let e=await B.findOne({_id:d,$or:[{sharedBy:b.user.id},{sharedWith:b.user.id}]});if(!e)return u.NextResponse.json({error:"Sharing record not found"},{status:404});return e.status="cancelled",e.cancelledAt=new Date,await e.save(),u.NextResponse.json({message:"Sharing cancelled successfully"})}catch(a){return console.error("Error cancelling sharing:",a),u.NextResponse.json({error:"Internal server error"},{status:500})}}let J=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/keys/share/route",pathname:"/api/keys/share",filename:"route",bundlePath:"app/api/keys/share/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/karthikgurram/projects/innovation/final/key-management/app/api/keys/share/route.js",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:K,workUnitAsyncStorage:L,serverHooks:M}=J;function N(){return(0,g.patchFetch)({workAsyncStorage:K,workUnitAsyncStorage:L})}async function O(a,b,c){var d;let e="/api/keys/share/route";"/index"===e&&(e="/");let g=await J.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||J.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===J.isDev||!E,H=E&&!G,I=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>J.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>J.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await J.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await J.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(L||await J.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},10846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{a.exports=require("querystring")},12412:a=>{a.exports=require("assert")},21820:a=>{a.exports=require("os")},27910:a=>{a.exports=require("stream")},28354:a=>{a.exports=require("util")},29021:a=>{a.exports=require("fs")},29294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:a=>{a.exports=require("path")},34631:a=>{a.exports=require("tls")},37366:a=>{a.exports=require("dns")},37652:(a,b,c)=>{c.r(b),c.d(b,{default:()=>g});var d=c(56037),e=c.n(d);let f=new(e()).Schema({email:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:[/^[^\s@]+@[^\s@]+\.[^\s@]+$/,"Please enter a valid email address"]},name:{type:String,required:!0,trim:!0},employeeId:{type:String,required:!0,unique:!0,trim:!0},role:{type:String,required:!0,enum:["faculty","hod","security","security_head","admin"],default:"faculty"},department:{type:String,required:!0,trim:!0},image:{type:String,default:null},googleId:{type:String,default:null},password:{type:String,default:null},profileImage:{type:String,default:null},isActive:{type:Boolean,default:!0},lastLogin:{type:Date,default:null},passwordResetRequired:{type:Boolean,default:!1},createdBy:{type:e().Schema.Types.ObjectId,ref:"User",default:null},deletedAt:{type:Date,default:null},deletedBy:{type:e().Schema.Types.ObjectId,ref:"User",default:null},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0});f.index({role:1}),f.index({department:1}),f.index({googleId:1}),f.index({isActive:1}),f.index({createdAt:-1}),f.pre("save",function(a){this.updatedAt=new Date,a()}),f.methods.toJSON=function(){let a=this.toObject();return delete a.__v,a},f.methods.updateLastLogin=function(){return this.lastLogin=new Date,this.save()},f.statics.findByEmail=function(a){return this.findOne({email:a.toLowerCase()})},f.statics.findByEmployeeId=function(a){return this.findOne({employeeId:a})},f.statics.findByRole=function(a){return this.find({role:a,isActive:!0})},f.statics.findByDepartment=function(a){return this.find({department:a,isActive:!0})},f.statics.findByGoogleId=function(a){return this.findOne({googleId:a})},f.virtual("displayName").get(function(){return this.name});let g=e().models.User||e().model("User",f)},44870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{a.exports=require("crypto")},55591:a=>{a.exports=require("https")},56037:a=>{a.exports=require("mongoose")},63033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{a.exports=require("zlib")},79428:a=>{a.exports=require("buffer")},79551:a=>{a.exports=require("url")},79646:a=>{a.exports=require("child_process")},81630:a=>{a.exports=require("http")},86439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91645:a=>{a.exports=require("net")},92729:(a,b,c)=>{c.d(b,{A:()=>g});var d=c(49526);let e={KEY_OVERDUE:{subject:"Key Return Reminder - VNR Key Management",template:a=>`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #88041c; color: white; padding: 20px; text-align: center;">
          <h1>VNR Key Management System</h1>
        </div>
        <div style="padding: 20px; background: #f9f9f9;">
          <h2 style="color: #88041c;">Key Return Reminder</h2>
          <p>Dear ${a.facultyName},</p>
          <p>This is a reminder that the following key is overdue for return:</p>
          <div style="background: white; padding: 15px; border-left: 4px solid #ef4444; margin: 20px 0;">
            <strong>Key:</strong> ${a.keyName}<br>
            <strong>Lab:</strong> ${a.labName}<br>
            <strong>Days Overdue:</strong> ${a.daysOverdue}<br>
            <strong>Due Date:</strong> ${a.dueDate}
          </div>
          <p>Please return the key to the security desk immediately to avoid any penalties.</p>
          <p>If you have any questions, please contact the security office.</p>
          <p>Best regards,<br>VNR Key Management Team</p>
        </div>
      </div>
    `},KEY_ASSIGNMENT:{subject:"New Key Assignment - VNR Key Management",template:a=>`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #88041c; color: white; padding: 20px; text-align: center;">
          <h1>VNR Key Management System</h1>
        </div>
        <div style="padding: 20px; background: #f9f9f9;">
          <h2 style="color: #88041c;">New Key Assignment</h2>
          <p>Dear ${a.facultyName},</p>
          <p>You have been assigned access to the following key:</p>
          <div style="background: white; padding: 15px; border-left: 4px solid #22c55e; margin: 20px 0;">
            <strong>Key:</strong> ${a.keyName}<br>
            <strong>Lab:</strong> ${a.labName}<br>
            <strong>Access Type:</strong> ${a.accessType}<br>
            <strong>Assigned Date:</strong> ${a.assignedDate}
          </div>
          <p>You can now collect this key from the security desk during office hours.</p>
          <p>Please remember to return the key on time to avoid any issues.</p>
          <p>Best regards,<br>VNR Key Management Team</p>
        </div>
      </div>
    `},SECURITY_ALERT:{subject:"Security Alert - VNR Key Management",template:a=>`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #88041c; color: white; padding: 20px; text-align: center;">
          <h1>VNR Key Management System</h1>
        </div>
        <div style="padding: 20px; background: #f9f9f9;">
          <h2 style="color: #ef4444;">Security Alert</h2>
          <p>Dear Security Team,</p>
          <p>The following security alert requires immediate attention:</p>
          <div style="background: white; padding: 15px; border-left: 4px solid #ef4444; margin: 20px 0;">
            <strong>Alert Type:</strong> ${a.alertType}<br>
            <strong>Key:</strong> ${a.keyName}<br>
            <strong>Faculty:</strong> ${a.facultyName}<br>
            <strong>Details:</strong> ${a.details}<br>
            <strong>Time:</strong> ${a.timestamp}
          </div>
          <p>Please take appropriate action immediately.</p>
          <p>Best regards,<br>VNR Key Management System</p>
        </div>
      </div>
    `},WEEKLY_REPORT:{subject:"Weekly Key Usage Report - VNR Key Management",template:a=>`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: #88041c; color: white; padding: 20px; text-align: center;">
          <h1>VNR Key Management System</h1>
        </div>
        <div style="padding: 20px; background: #f9f9f9;">
          <h2 style="color: #88041c;">Weekly Key Usage Report</h2>
          <p>Dear ${a.recipientName},</p>
          <p>Here's your weekly key usage summary for ${a.weekPeriod}:</p>
          <div style="background: white; padding: 15px; margin: 20px 0;">
            <h3>Summary Statistics:</h3>
            <ul>
              <li>Total Transactions: ${a.totalTransactions}</li>
              <li>Keys Collected: ${a.keysCollected}</li>
              <li>Keys Returned: ${a.keysReturned}</li>
              <li>Overdue Keys: ${a.overdueKeys}</li>
              <li>Active Delegations: ${a.activeDelegations}</li>
            </ul>
          </div>
          <p>For detailed reports, please log in to the key management system.</p>
          <p>Best regards,<br>VNR Key Management Team</p>
        </div>
      </div>
    `}};class f{constructor(){this.transporter=null,this.initializeTransporter()}async initializeTransporter(){try{if(!process.env.SMTP_USER||!process.env.SMTP_PASS){console.warn("SMTP credentials not configured. Email service will be disabled."),this.transporter=null;return}this.transporter=d.createTransporter({host:process.env.SMTP_HOST||"smtp.gmail.com",port:process.env.SMTP_PORT||587,secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}}),await this.transporter.verify(),console.log("Email service initialized successfully")}catch(a){console.error("Failed to initialize email service:",a),this.transporter=null}}async sendEmail(a,b,c){if(!this.transporter)return console.warn("Email transporter not initialized. Email not sent to:",a),!0;try{let d=e[b];if(!d)return console.error("Email template not found:",b),!1;let f={from:`"VNR Key Management" <${process.env.SMTP_USER}>`,to:Array.isArray(a)?a.join(", "):a,subject:d.subject,html:d.template(c)},g=await this.transporter.sendMail(f);return console.log("Email sent successfully:",g.messageId),!0}catch(a){return console.error("Failed to send email:",a),!1}}async sendOverdueReminder(a,b){return this.sendEmail(a,"KEY_OVERDUE",{facultyName:b.facultyName,keyName:b.keyName,labName:b.labName,daysOverdue:b.daysOverdue,dueDate:new Date(b.dueDate).toLocaleDateString()})}async sendKeyAssignmentNotification(a,b){return this.sendEmail(a,"KEY_ASSIGNMENT",{facultyName:b.facultyName,keyName:b.keyName,labName:b.labName,accessType:b.accessType,assignedDate:new Date(b.assignedDate).toLocaleDateString()})}async sendSecurityAlert(a,b){return this.sendEmail(a,"SECURITY_ALERT",{alertType:b.alertType,keyName:b.keyName,facultyName:b.facultyName,details:b.details,timestamp:new Date(b.timestamp).toLocaleString()})}async sendWeeklyReport(a,b){return this.sendEmail(a,"WEEKLY_REPORT",{recipientName:b.recipientName,weekPeriod:b.weekPeriod,totalTransactions:b.totalTransactions,keysCollected:b.keysCollected,keysReturned:b.keysReturned,overdueKeys:b.overdueKeys,activeDelegations:b.activeDelegations})}async sendBulkOverdueReminders(a){let b=[];for(let c of a){let a=await this.sendOverdueReminder(c.facultyEmail,c);b.push({keyId:c.keyId,success:a})}return b}async sendDepartmentReport(a,b){return this.sendWeeklyReport(a,{recipientName:b.hodName,weekPeriod:b.weekPeriod,totalTransactions:b.stats.totalTransactions,keysCollected:b.stats.keysCollected,keysReturned:b.stats.keysReturned,overdueKeys:b.stats.overdueKeys,activeDelegations:b.stats.activeDelegations})}}let g=new f},94735:a=>{a.exports=require("events")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[96,73],()=>b(b.s=4985));module.exports=c})();