(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[751],{356:a=>{"use strict";a.exports=require("node:buffer")},521:a=>{"use strict";a.exports=require("node:async_hooks")},804:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>m});var d={};c.r(d),c.d(d,{config:()=>i,default:()=>h});var e=c(214),f=c(946),g=c(931);let h=(0,c(709).withAuth)(function(a){if(a.nextUrl.pathname.startsWith("/api/")){let b=g.NextResponse.next();return(b.headers.set("Access-Control-Allow-Origin",process.env.FRONTEND_URL||"http://localhost:3000"),b.headers.set("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),b.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization"),b.headers.set("Access-Control-Allow-Credentials","true"),"OPTIONS"===a.method)?new Response(null,{status:200,headers:b.headers}):b}let b=a.nextauth.token,c=a.nextUrl.pathname;return b&&(c.startsWith("/faculty")&&!["faculty","hod"].includes(b.role)||c.startsWith("/security")&&!["security","security_head"].includes(b.role)||c.startsWith("/securityincharge")&&"security_head"!==b.role||c.startsWith("/hod")&&"hod"!==b.role||c.startsWith("/admin")&&"admin"!==b.role)?g.NextResponse.redirect(new URL("/login",a.url)):g.NextResponse.next()},{callbacks:{authorized:({token:a,req:b})=>!!b.nextUrl.pathname.startsWith("/api/")||"/"===b.nextUrl.pathname||"/login"===b.nextUrl.pathname||"/register"===b.nextUrl.pathname||!!a}}),i={matcher:["/api/:path*","/faculty/:path*","/security/:path*","/securityincharge/:path*","/hod/:path*","/admin/:path*","/profile/:path*"]};c(938);let j={...d},k=j.middleware||j.default,l="/middleware";if("function"!=typeof k)throw Object.defineProperty(Error(`The Middleware "${l}" must export a \`middleware\` or a \`default\` function`),"__NEXT_ERROR_CODE",{value:"E120",enumerable:!1,configurable:!0});function m(a){return(0,f.O)({...a,page:l,handler:async(...a)=>{try{return await k(...a)}catch(f){let b=a[0],c=new URL(b.url),d=c.pathname+c.search;throw await (0,e.Ek)(f,{path:d,method:b.method,headers:Object.fromEntries(b.headers.entries())},{routerKind:"Pages Router",routePath:"/middleware",routeType:"middleware",revalidateReason:void 0}),f}}})}}},a=>{a.O(0,[96],()=>a(a.s=804));var b=a.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES).middleware_middleware=b}]);
//# sourceMappingURL=middleware.js.map