(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[202],{464:(e,s,r)=>{"use strict";r.d(s,{DD:()=>f,HP:()=>j,MJ:()=>u,gX:()=>m,hw:()=>h,qb:()=>x});var t=r(5155),l=r(2115),a=r(2108),i=r(5695),n=r(3169);let c=()=>(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}),d=e=>{let{requiredRole:s,userRole:r}=e;return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,t.jsx)("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access this page."}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 mb-6",children:[(0,t.jsxs)("p",{children:["Required role: ",(0,t.jsx)("span",{className:"font-semibold",children:Array.isArray(s)?s.join(" or "):s})]}),(0,t.jsxs)("p",{children:["Your role: ",(0,t.jsx)("span",{className:"font-semibold",children:r||"None"})]})]}),(0,t.jsx)("button",{onClick:()=>window.history.back(),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition-colors",children:"Go Back"})]})})},o=e=>{let{children:s,requiredRole:r=null,requiredRoles:o=null,redirectTo:m="/login",fallback:u=null}=e,{data:x,status:h}=(0,a.useSession)(),{user:f,loading:j,hasRole:y,hasAnyRole:p}=(0,n.As)(),g=(0,i.useRouter)();if((0,l.useEffect)(()=>{if(console.log("\uD83D\uDEE1️ ProtectedRoute: Auth state check:",{session:!!x,status:h,loading:j,userRole:null==f?void 0:f.role,requiredRole:r,requiredRoles:o,userEmail:null==f?void 0:f.email}),"loading"===h||j)return void console.log("\uD83D\uDEE1️ ProtectedRoute: Still loading, waiting...");if(!x||!f){console.log("\uD83D\uDEE1️ ProtectedRoute: Not authenticated, redirecting to login"),g.push(m);return}return r&&(null==f?void 0:f.role)!==r?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for single role:",{userRole:null==f?void 0:f.role,requiredRole:r}):o&&!o.includes(null==f?void 0:f.role)?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for multiple roles:",{userRole:null==f?void 0:f.role,requiredRoles:o,includes:o.includes(null==f?void 0:f.role)}):void console.log("\uD83D\uDEE1️ ProtectedRoute: All checks passed, rendering content")},[x,h,j,null==f?void 0:f.role,r,o,g,m]),"loading"===h||j)return u||(0,t.jsx)(c,{});if(!x||!f)return null;let N=o||r;return!N||(o?p(o):y(r))?s:(0,t.jsx)(d,{requiredRole:N,userRole:null==f?void 0:f.role})},m=e=>{let{children:s,...r}=e;return(0,t.jsx)(o,{requiredRoles:["faculty","hod"],...r,children:s})},u=e=>{let{children:s,...r}=e;return(0,t.jsx)(o,{requiredRoles:["security","security_head"],...r,children:s})},x=e=>{let{children:s,...r}=e;return(0,t.jsx)(o,{requiredRole:"security_head",...r,children:s})},h=e=>{let{children:s,...r}=e;return(0,t.jsx)(o,{requiredRole:"admin",...r,children:s})},f=e=>{let{children:s,...r}=e;return(0,t.jsx)(o,{requiredRole:"hod",...r,children:s})},j=e=>{let{children:s,...r}=e;return(0,t.jsx)(o,{...r,children:s})}},3691:(e,s,r)=>{Promise.resolve().then(r.bind(r,6670))},6670:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>f});var t=r(5155),l=r(464),a=r(2115),i=r(5695),n=r(646),c=r(4861),d=r(5525),o=r(4355),m=r(7901),u=r(6826),x=r(3169);let h=()=>{let[e,s]=(0,a.useState)(!1),[r,l]=(0,a.useState)(null),[h,f]=(0,a.useState)(""),j=(0,i.useRouter)(),{user:y}=(0,x.As)(),{loading:p,clearError:g,clearResult:N,scanQRCode:v}=(0,x.xf)(),{success:b,error:k}=(0,u.dj)();(0,a.useEffect)(()=>{if("undefined"!=typeof navigator){var e;let s=navigator.userAgent,r=(null==(e=navigator.userAgentData)?void 0:e.platform)||navigator.platform||"Unknown";f("".concat(r," - ").concat(s.substring(0,100)))}},[]);let R=async e=>{console.log("QR Code scanned:",e),s(!1);let r=window.location.href;try{let s=await v(e,r,h);s.success?(l({type:"success",message:"Key verification successful!",data:s.data}),b("QR code scanned successfully - key verified!")):(l({type:"error",message:s.error||"Key verification failed",data:null}),k(s.error||"Key verification failed"))}catch(e){l({type:"error",message:"Failed to process QR code",data:null}),k("Failed to process QR code")}},w=()=>{l(null),s(!1)};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(u.Y9,{title:"Security QR Scanner",showBack:!0,onBackClick:()=>{(null==y?void 0:y.role)==="security_incharge"?j.push("/securityincharge"):j.push("/security")},showProfile:!0,onProfileClick:()=>console.log("Profile clicked")}),(0,t.jsxs)("main",{className:"px-4 py-6 pb-20",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(u.Zp,{className:"bg-primary-50 border-primary-200",children:(0,t.jsxs)("div",{className:"p-4 flex items-center",children:[(0,t.jsx)(d.A,{className:"h-8 w-8 text-primary-600 mr-3"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium text-primary-900",children:"Security Verification"}),(0,t.jsx)("p",{className:"text-sm text-primary-700",children:"Scan QR codes to verify key access"})]})]})})}),(0,t.jsxs)("div",{className:"mb-6",children:[!e&&!r&&(0,t.jsxs)(u.Zp,{className:"p-8 text-center",children:[(0,t.jsx)(o.A,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Ready to Verify"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Tap the button below to start scanning QR codes for key verification"}),(0,t.jsxs)(u.$n,{variant:"primary",onClick:()=>{g(),N(),l(null),s(!0)},className:"w-full",disabled:p,children:[(0,t.jsx)(m.A,{className:"h-5 w-5 mr-2"}),"Start Scanning"]})]}),(0,t.jsx)(u.ER,{isActive:e,onScanSuccess:R,onScanError:e=>{console.log("QR Scan error:",e)},onClose:()=>{s(!1)}}),r&&(0,t.jsx)(e=>{var s;let{result:r}=e,l="success"===r.type,a=l?n.A:c.A,i=l?"bg-green-50":"bg-red-50",d=l?"text-green-800":"text-red-800",o=l?"text-green-600":"text-red-600";return(0,t.jsx)(u.Zp,{className:"".concat(i," border-0"),children:(0,t.jsxs)("div",{className:"p-6 text-center",children:[(0,t.jsx)(a,{className:"h-16 w-16 ".concat(o," mx-auto mb-4")}),(0,t.jsx)("h3",{className:"text-lg font-medium ".concat(d," mb-2"),children:l?"Verification Successful":"Verification Failed"}),(0,t.jsx)("p",{className:"".concat(d," mb-4"),children:r.message}),l&&(null==(s=r.data)?void 0:s.key)&&(0,t.jsxs)("div",{className:"bg-white rounded-lg p-4 mb-4",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Key Details"}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Key ID:"})," ",r.data.key.keyId]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Key Name:"})," ",r.data.key.keyName]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Lab:"})," ",r.data.key.labName]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Department:"})," ",r.data.key.department]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Location:"})," ",r.data.key.location]})]})]}),(0,t.jsx)(u.$n,{variant:"primary",onClick:w,className:"w-full",children:"Scan Another Key"})]})})},{result:r})]}),(0,t.jsx)(u.Zp,{className:"mb-6",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-3",children:"Security Instructions"}),(0,t.jsxs)("div",{className:"space-y-3 text-sm text-gray-600",children:[(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-6 w-6 bg-primary-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:(0,t.jsx)("span",{className:"text-primary-600 font-medium text-xs",children:"1"})}),(0,t.jsx)("p",{children:"Verify faculty identity before allowing key access"})]}),(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-6 w-6 bg-primary-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:(0,t.jsx)("span",{className:"text-primary-600 font-medium text-xs",children:"2"})}),(0,t.jsx)("p",{children:"Scan the QR code to verify key assignment"})]}),(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-6 w-6 bg-primary-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:(0,t.jsx)("span",{className:"text-primary-600 font-medium text-xs",children:"3"})}),(0,t.jsx)("p",{children:"Check that the key details match the request"})]}),(0,t.jsxs)("div",{className:"flex items-start",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-6 w-6 bg-primary-100 rounded-full flex items-center justify-center mr-3 mt-0.5",children:(0,t.jsx)("span",{className:"text-primary-600 font-medium text-xs",children:"4"})}),(0,t.jsx)("p",{children:"Only release keys to authorized faculty members"})]})]})]})})]})]})};function f(){return(0,t.jsx)(l.qb,{children:(0,t.jsx)(h,{})})}}},e=>{e.O(0,[96,826,358],()=>e(e.s=3691)),_N_E=e.O()}]);