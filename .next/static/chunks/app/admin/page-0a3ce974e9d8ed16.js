(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{109:(e,s,r)=>{Promise.resolve().then(r.bind(r,9915))},464:(e,s,r)=>{"use strict";r.d(s,{DD:()=>g,HP:()=>j,MJ:()=>h,gX:()=>u,hw:()=>x,qb:()=>m});var l=r(5155),t=r(2115),i=r(2108),n=r(5695),o=r(3169);let a=()=>(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,l.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}),d=e=>{let{requiredRole:s,userRole:r}=e;return(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,l.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,l.jsx)("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access this page."}),(0,l.jsxs)("div",{className:"text-sm text-gray-500 mb-6",children:[(0,l.jsxs)("p",{children:["Required role: ",(0,l.jsx)("span",{className:"font-semibold",children:Array.isArray(s)?s.join(" or "):s})]}),(0,l.jsxs)("p",{children:["Your role: ",(0,l.jsx)("span",{className:"font-semibold",children:r||"None"})]})]}),(0,l.jsx)("button",{onClick:()=>window.history.back(),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition-colors",children:"Go Back"})]})})},c=e=>{let{children:s,requiredRole:r=null,requiredRoles:c=null,redirectTo:u="/login",fallback:h=null}=e,{data:m,status:x}=(0,i.useSession)(),{user:g,loading:j,hasRole:v,hasAnyRole:p}=(0,o.As)(),y=(0,n.useRouter)();if((0,t.useEffect)(()=>{if(console.log("\uD83D\uDEE1️ ProtectedRoute: Auth state check:",{session:!!m,status:x,loading:j,userRole:null==g?void 0:g.role,requiredRole:r,requiredRoles:c,userEmail:null==g?void 0:g.email}),"loading"===x||j)return void console.log("\uD83D\uDEE1️ ProtectedRoute: Still loading, waiting...");if(!m||!g){console.log("\uD83D\uDEE1️ ProtectedRoute: Not authenticated, redirecting to login"),y.push(u);return}return r&&(null==g?void 0:g.role)!==r?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for single role:",{userRole:null==g?void 0:g.role,requiredRole:r}):c&&!c.includes(null==g?void 0:g.role)?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for multiple roles:",{userRole:null==g?void 0:g.role,requiredRoles:c,includes:c.includes(null==g?void 0:g.role)}):void console.log("\uD83D\uDEE1️ ProtectedRoute: All checks passed, rendering content")},[m,x,j,null==g?void 0:g.role,r,c,y,u]),"loading"===x||j)return h||(0,l.jsx)(a,{});if(!m||!g)return null;let f=c||r;return!f||(c?p(c):v(r))?s:(0,l.jsx)(d,{requiredRole:f,userRole:null==g?void 0:g.role})},u=e=>{let{children:s,...r}=e;return(0,l.jsx)(c,{requiredRoles:["faculty","hod"],...r,children:s})},h=e=>{let{children:s,...r}=e;return(0,l.jsx)(c,{requiredRoles:["security","security_head"],...r,children:s})},m=e=>{let{children:s,...r}=e;return(0,l.jsx)(c,{requiredRole:"security_head",...r,children:s})},x=e=>{let{children:s,...r}=e;return(0,l.jsx)(c,{requiredRole:"admin",...r,children:s})},g=e=>{let{children:s,...r}=e;return(0,l.jsx)(c,{requiredRole:"hod",...r,children:s})},j=e=>{let{children:s,...r}=e;return(0,l.jsx)(c,{...r,children:s})}},3169:(e,s,r)=>{"use strict";r.d(s,{As:()=>d,OJ:()=>a,xf:()=>c});var l=r(5155),t=r(2115),i=r(5695),n=r(2108);r(7383);let o=(0,t.createContext)();function a(e){let{children:s}=e,{data:r,status:a}=(0,n.useSession)(),[d,c]=(0,t.useState)(null),[u,h]=(0,t.useState)(!0),m=(0,i.useRouter)();(0,t.useEffect)(()=>{if("loading"===a)return void h(!0);(null==r?void 0:r.user)?c({id:r.user.id,name:r.user.name,email:r.user.email,image:r.user.image,role:r.user.role,department:r.user.department,employeeId:r.user.employeeId}):c(null),h(!1)},[r,a]);let x=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"google";try{let s=await (0,n.signIn)(e,{callbackUrl:j(null==d?void 0:d.role)||"/"});return{success:!0,result:s}}catch(e){return console.error("Login error:",e),{success:!1,error:"Login failed"}}},g=async()=>{try{await (0,n.signOut)({callbackUrl:"/login"})}catch(e){console.error("Logout error:",e)}},j=e=>{switch(e){case"admin":return"/admin";case"hod":return"/hod";case"security_head":return"/securityincharge";case"security":return"/security";case"faculty":return"/faculty";default:return"/"}};return(0,l.jsx)(o.Provider,{value:{user:d,loading:u||"loading"===a,login:x,logout:g,hasRole:e=>{if(!(null==d?void 0:d.role))return!1;let s={admin:4,security_head:3,hod:2,security:1,faculty:1};return(s[d.role]||0)>=(s[e]||0)},hasAnyRole:e=>!!(null==d?void 0:d.role)&&!!Array.isArray(e)&&e.includes(d.role),isRole:e=>(null==d?void 0:d.role)===e,navigateToDashboard:()=>{let e=j(null==d?void 0:d.role);console.log("\uD83D\uDE80 navigateToDashboard: Navigating to:",{userRole:null==d?void 0:d.role,dashboardUrl:e,userEmail:null==d?void 0:d.email});try{console.log("\uD83D\uDE80 navigateToDashboard: Attempting router.push..."),m.push(e),setTimeout(()=>{console.log("\uD83D\uDE80 navigateToDashboard: Router.push timeout, using window.location fallback"),window.location.href=e},1e3)}catch(s){console.error("\uD83D\uDE80 navigateToDashboard: Router.push failed, using window.location:",s),window.location.href=e}},getDashboardUrl:j,session:r},children:s})}function d(){let e=(0,t.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let[e,s]=(0,t.useState)(!1),[r,l]=(0,t.useState)(null),[i,n]=(0,t.useState)(null);return{loading:e,error:r,scanResult:i,clearError:()=>l(null),clearResult:()=>n(null),scanQRCode:async(e,r,t)=>{s(!0),l(null);try{let s=await fetch("/api/security/scan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({qrData:e,action:"collection",location:r,deviceInfo:t})}),l=await s.json();if(!s.ok)throw Error(l.error||"Failed to process QR code");return n(l),{success:!0,data:l}}catch(s){let e=s.message||"Failed to process QR code";return l(e),{success:!1,error:e}}finally{s(!1)}}}}},9915:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>n});var l=r(5155),t=r(464),i=r(3169);function n(){let{user:e,logout:s}=(0,i.As)();return(0,l.jsx)(t.hw,{children:(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)("div",{className:"bg-white shadow",children:(0,l.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("div",{className:"h-8 w-8 bg-red-600 rounded-full flex items-center justify-center",children:(0,l.jsxs)("svg",{className:"h-5 w-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})}),(0,l.jsxs)("div",{className:"ml-4",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:"System Administrator - Key Management System"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==e?void 0:e.name}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:[null==e?void 0:e.role," • ",null==e?void 0:e.department]})]}),(0,l.jsx)("button",{onClick:s,className:"bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition-colors",children:"Logout"})]})]})})}),(0,l.jsx)("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,l.jsx)("div",{className:"px-4 py-6 sm:px-0",children:(0,l.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,l.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,l.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Welcome to Admin Dashboard"}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,l.jsx)("p",{className:"mb-4",children:"You are logged in as System Administrator with full access to all system functions."}),(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,l.jsx)("h4",{className:"font-medium text-red-900 mb-2",children:"Your Access Details:"}),(0,l.jsxs)("ul",{className:"list-disc list-inside text-red-800 space-y-1",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Email:"})," ",null==e?void 0:e.email]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Role:"})," ",null==e?void 0:e.role]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Department:"})," ",null==e?void 0:e.department]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("strong",{children:"Employee ID:"})," ",null==e?void 0:e.employeeId]})]})]})]})]})})})})]})})}}},e=>{e.O(0,[96,358],()=>e(e.s=109)),_N_E=e.O()}]);