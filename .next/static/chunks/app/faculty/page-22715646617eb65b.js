(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{464:(e,s,a)=>{"use strict";a.d(s,{DD:()=>y,HP:()=>p,MJ:()=>x,gX:()=>m,hw:()=>h,qb:()=>u});var t=a(5155),r=a(2115),i=a(2108),n=a(5695),l=a(3169);let c=()=>(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}),o=e=>{let{requiredRole:s,userRole:a}=e;return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,t.jsx)("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access this page."}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 mb-6",children:[(0,t.jsxs)("p",{children:["Required role: ",(0,t.jsx)("span",{className:"font-semibold",children:Array.isArray(s)?s.join(" or "):s})]}),(0,t.jsxs)("p",{children:["Your role: ",(0,t.jsx)("span",{className:"font-semibold",children:a||"None"})]})]}),(0,t.jsx)("button",{onClick:()=>window.history.back(),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition-colors",children:"Go Back"})]})})},d=e=>{let{children:s,requiredRole:a=null,requiredRoles:d=null,redirectTo:m="/login",fallback:x=null}=e,{data:u,status:h}=(0,i.useSession)(),{user:y,loading:p,hasRole:f,hasAnyRole:j}=(0,l.As)(),N=(0,n.useRouter)();if((0,r.useEffect)(()=>{if(console.log("\uD83D\uDEE1️ ProtectedRoute: Auth state check:",{session:!!u,status:h,loading:p,userRole:null==y?void 0:y.role,requiredRole:a,requiredRoles:d,userEmail:null==y?void 0:y.email}),"loading"===h||p)return void console.log("\uD83D\uDEE1️ ProtectedRoute: Still loading, waiting...");if(!u||!y){console.log("\uD83D\uDEE1️ ProtectedRoute: Not authenticated, redirecting to login"),N.push(m);return}return a&&(null==y?void 0:y.role)!==a?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for single role:",{userRole:null==y?void 0:y.role,requiredRole:a}):d&&!d.includes(null==y?void 0:y.role)?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for multiple roles:",{userRole:null==y?void 0:y.role,requiredRoles:d,includes:d.includes(null==y?void 0:y.role)}):void console.log("\uD83D\uDEE1️ ProtectedRoute: All checks passed, rendering content")},[u,h,p,null==y?void 0:y.role,a,d,N,m]),"loading"===h||p)return x||(0,t.jsx)(c,{});if(!u||!y)return null;let g=d||a;return!g||(d?j(d):f(a))?s:(0,t.jsx)(o,{requiredRole:g,userRole:null==y?void 0:y.role})},m=e=>{let{children:s,...a}=e;return(0,t.jsx)(d,{requiredRoles:["faculty","hod"],...a,children:s})},x=e=>{let{children:s,...a}=e;return(0,t.jsx)(d,{requiredRoles:["security","security_head"],...a,children:s})},u=e=>{let{children:s,...a}=e;return(0,t.jsx)(d,{requiredRole:"security_head",...a,children:s})},h=e=>{let{children:s,...a}=e;return(0,t.jsx)(d,{requiredRole:"admin",...a,children:s})},y=e=>{let{children:s,...a}=e;return(0,t.jsx)(d,{requiredRole:"hod",...a,children:s})},p=e=>{let{children:s,...a}=e;return(0,t.jsx)(d,{...a,children:s})}},7567:(e,s,a)=>{Promise.resolve().then(a.bind(a,9835))},9130:(e,s,a)=>{"use strict";a.d(s,{E$:()=>d,ph:()=>o});var t=a(5155),r=a(2115);let i=(0,r.createContext)(),n={KEY_OVERDUE:{type:"alert",priority:"high",roles:["faculty","hod","security_head"],autoExpire:!1},KEY_ASSIGNMENT:{type:"info",priority:"medium",roles:["faculty"],autoExpire:!0,expireAfter:864e5},KEY_DELEGATION:{type:"info",priority:"medium",roles:["faculty","hod"],autoExpire:!0,expireAfter:6048e5},SECURITY_ALERT:{type:"alert",priority:"high",roles:["security","security_head"],autoExpire:!1},SYSTEM_MAINTENANCE:{type:"warning",priority:"medium",roles:["faculty","security","hod","security_head"],autoExpire:!0,expireAfter:72e5},REPORT_READY:{type:"success",priority:"low",roles:["hod","security_head"],autoExpire:!0,expireAfter:6048e5}},l=(e,s)=>{switch(s.type){case"ADD_NOTIFICATION":return{...e,notifications:[s.payload,...e.notifications],unreadCount:e.unreadCount+1};case"MARK_AS_READ":return{...e,notifications:e.notifications.map(e=>e.id===s.payload?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)};case"MARK_ALL_AS_READ":return{...e,notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0};case"DELETE_NOTIFICATION":let a=e.notifications.find(e=>e.id===s.payload);return{...e,notifications:e.notifications.filter(e=>e.id!==s.payload),unreadCount:a&&!a.read?Math.max(0,e.unreadCount-1):e.unreadCount};case"CLEAR_EXPIRED":let t=Date.now(),r=e.notifications.filter(e=>!e.expiresAt||e.expiresAt>t),i=e.notifications.filter(e=>e.expiresAt&&e.expiresAt<=t&&!e.read).length;return{...e,notifications:r,unreadCount:Math.max(0,e.unreadCount-i)};case"SET_NOTIFICATIONS":let n=s.payload.filter(e=>!e.read).length;return{...e,notifications:s.payload,unreadCount:n};default:return e}},c={notifications:[],unreadCount:0},o=e=>{let{children:s,userRole:a}=e,[o,d]=(0,r.useReducer)(l,c);(0,r.useEffect)(()=>{let e=setInterval(()=>{d({type:"CLEAR_EXPIRED"})},6e4);return()=>clearInterval(e)},[]);let m=e=>{let s=n[e.notificationType]||{type:"info",priority:"medium",roles:["faculty","security","hod","security_head"],autoExpire:!1};if(!s.roles.includes(a))return;let t={id:"notif_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),title:e.title,message:e.message,type:s.type,priority:s.priority,category:e.category||"General",timestamp:new Date,read:!1,expiresAt:s.autoExpire?Date.now()+s.expireAfter:null,data:e.data||{}};d({type:"ADD_NOTIFICATION",payload:t}),"granted"===Notification.permission&&"high"===s.priority&&new Notification(t.title,{body:t.message,icon:"/VNRVJIETLOGO.png",tag:t.id})},x=async()=>"Notification"in window&&"default"===Notification.permission?"granted"===await Notification.requestPermission():"granted"===Notification.permission,u={notifications:o.notifications,unreadCount:o.unreadCount,addNotification:m,markAsRead:e=>{d({type:"MARK_AS_READ",payload:e})},markAllAsRead:()=>{d({type:"MARK_ALL_AS_READ"})},deleteNotification:e=>{d({type:"DELETE_NOTIFICATION",payload:e})},requestNotificationPermission:x,...{keyOverdueReminder:(e,s)=>m({notificationType:"KEY_OVERDUE",title:"Key Return Reminder",message:"".concat(e," is ").concat(s," day(s) overdue. Please return immediately."),category:"Key Management",data:{keyName:e,daysOverdue:s}}),keyAssigned:(e,s)=>m({notificationType:"KEY_ASSIGNMENT",title:"New Key Assignment",message:"You have been assigned access to ".concat(e," (").concat(s,")."),category:"Key Management",data:{keyName:e,labName:s}}),keyDelegated:(e,s,a)=>m({notificationType:"KEY_DELEGATION",title:"Key Access Shared",message:"".concat(s," has shared ").concat(e," access with you for ").concat(a,"."),category:"Key Sharing",data:{keyName:e,fromFaculty:s,duration:a}}),overdueAlert:(e,s,a)=>m({notificationType:"SECURITY_ALERT",title:"Overdue Key Alert",message:"".concat(e," is ").concat(a," day(s) overdue. Faculty: ").concat(s),category:"Security Alert",data:{keyName:e,facultyName:s,daysOverdue:a}}),departmentReport:(e,s)=>m({notificationType:"REPORT_READY",title:"Department Report Ready",message:"".concat(e," report for ").concat(s," is ready for review."),category:"Reports",data:{reportType:e,period:s}}),maintenanceAlert:(e,s)=>m({notificationType:"SYSTEM_MAINTENANCE",title:"Scheduled Maintenance",message:"System maintenance scheduled for ".concat(e,". Duration: ").concat(s,"."),category:"System",data:{startTime:e,duration:s}})}};return(0,t.jsx)(i.Provider,{value:u,children:s})},d=()=>{let e=(0,r.useContext)(i);if(!e)throw Error("useNotifications must be used within a NotificationProvider");return e}},9835:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>T});var t=a(5155),r=a(464),i=a(2115),n=a(9803),l=a(9869),c=a(3227),o=a(9676),d=a(7924),m=a(6932),x=a(4516),u=a(4186),h=a(7939),y=a(6516),p=a(3861),f=a(5695),j=a(6826),N=a(3169),g=a(9130),v=a(1243),w=a(4357),b=a(1788),A=a(6862);let k=e=>{let{isOpen:s,onClose:a,keyData:r,mode:l="collection"}=e,[c,o]=(0,i.useState)(""),[d,m]=(0,i.useState)(600),[p,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{s&&r&&(N(),g())},[s,r]);let N=async()=>{try{let e={keyId:r.id,facultyId:r.facultyId||"faculty-001",action:l,timestamp:Date.now(),expiresAt:Date.now()+6e5},s=JSON.stringify(e),a=await A.toDataURL(s,{width:300,margin:2,color:{dark:"#1f2937",light:"#ffffff"}});o(a)}catch(e){console.error("Error generating QR code:",e)}},g=()=>{m(600),f(!1);let e=setInterval(()=>{m(s=>s<=1?(f(!0),clearInterval(e),0):s-1)},1e3);return()=>clearInterval(e)},k=async()=>{try{await navigator.clipboard.writeText(c)}catch(e){console.error("Failed to copy QR code:",e)}},E=async()=>{if(navigator.share)try{await navigator.share({title:"QR Code - ".concat(null==r?void 0:r.keyName),text:"QR code for ".concat(l," of ").concat(null==r?void 0:r.keyName),url:c})}catch(e){console.error("Error sharing:",e)}};return r?(0,t.jsx)(j.aF,{isOpen:s,onClose:a,title:"".concat("collection"===l?"Collect":"Deposit"," Key"),size:"md",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Zp,{role:"faculty",padding:"sm",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-faculty rounded-lg flex items-center justify-center",children:(0,t.jsx)(n.A,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-primary",children:r.keyName}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-secondary",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(x.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[r.labName," (",r.labNumber,")"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(j.Ex,{variant:"permanent"===r.accessType?"success":"warning",size:"sm",children:r.accessType}),r.isOverdue&&(0,t.jsx)(j.Ex,{variant:"danger",size:"sm",children:"Overdue"})]})]})]})]})}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("div",{className:"inline-block p-4 bg-white rounded-2xl shadow-card",children:c?(0,t.jsx)("img",{src:c,alt:"QR Code",className:"w-64 h-64 mx-auto"}):(0,t.jsx)("div",{className:"w-64 h-64 bg-surface-secondary rounded-lg flex items-center justify-center",children:(0,t.jsx)(h.A,{className:"h-12 w-12 text-muted"})})})}),(0,t.jsx)("div",{className:"text-center",children:p?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-danger",children:[(0,t.jsx)(v.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"QR Code Expired"})]}),(0,t.jsx)(j.$n,{variant:"primary",onClick:()=>{N(),g()},className:"w-full",children:"Generate New QR Code"})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 text-warning"}),(0,t.jsxs)("span",{className:"text-sm text-secondary",children:["Expires in: ",(0,t.jsx)("span",{className:"font-mono font-medium text-warning",children:(e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))})(d)})]})]}),(0,t.jsxs)("p",{className:"text-xs text-muted",children:["Show this QR code to security for ",l]})]})}),!p&&(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsx)(j.$n,{variant:"ghost",size:"sm",onClick:k,icon:(0,t.jsx)(w.A,{className:"h-4 w-4"}),children:"Copy"}),(0,t.jsx)(j.$n,{variant:"ghost",size:"sm",onClick:()=>{let e=document.createElement("a");e.download="qr-".concat(null==r?void 0:r.keyName,"-").concat(l,"-").concat(Date.now(),".png"),e.href=c,e.click()},icon:(0,t.jsx)(b.A,{className:"h-4 w-4"}),children:"Download"}),(0,t.jsx)(j.$n,{variant:"ghost",size:"sm",onClick:E,icon:(0,t.jsx)(y.A,{className:"h-4 w-4"}),children:"Share"})]}),(0,t.jsx)(j.Zp,{variant:"info",padding:"sm",children:(0,t.jsxs)("div",{className:"text-sm space-y-2",children:[(0,t.jsx)("h4",{className:"font-medium text-primary",children:"Instructions:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-secondary",children:[(0,t.jsx)("li",{children:"• Present this QR code to security personnel"}),(0,t.jsx)("li",{children:"• QR code is valid for 10 minutes only"}),(0,t.jsxs)("li",{children:["• ","collection"===l?"Collect your key after verification":"Hand over the key after scanning"]}),(0,t.jsx)("li",{children:"• Keep your phone screen bright for easy scanning"})]})]})})]})}):null};var E=a(1007),C=a(4416),R=a(2486);let S=e=>{let{isOpen:s,onClose:a,keyData:r,onShare:l}=e,[c,o]=(0,i.useState)(""),[m,h]=(0,i.useState)(null),[y,p]=(0,i.useState)("1"),[f,N]=(0,i.useState)(""),[g]=(0,i.useState)([{id:"fac-001",name:"Dr. John Smith",email:"john.smith@vnrvjiet.in",department:"Computer Science",avatar:null},{id:"fac-002",name:"Prof. Sarah Johnson",email:"sarah.johnson@vnrvjiet.in",department:"Computer Science",avatar:null},{id:"fac-003",name:"Dr. Michael Brown",email:"michael.brown@vnrvjiet.in",department:"Information Technology",avatar:null}]),v=g.filter(e=>e.name.toLowerCase().includes(c.toLowerCase())||e.email.toLowerCase().includes(c.toLowerCase())||e.department.toLowerCase().includes(c.toLowerCase())),w=()=>{h(null),o(""),p("1"),N(""),a()};return r?(0,t.jsx)(j.aF,{isOpen:s,onClose:w,title:"Share Key Access",size:"lg",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Zp,{role:"faculty",padding:"sm",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-faculty rounded-lg flex items-center justify-center",children:(0,t.jsx)(n.A,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-semibold text-primary",children:r.keyName}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-secondary",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(x.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[r.labName," (",r.labNumber,")"]})]}),(0,t.jsx)(j.Ex,{variant:"permanent"===r.accessType?"success":"warning",size:"sm",children:r.accessType})]})]})]})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-primary",children:"Select Faculty Member"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted"}),(0,t.jsx)("input",{type:"text",placeholder:"Search faculty by name, email, or department...",value:c,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-surface border border-default rounded-xl focus:ring-2 focus:ring-faculty focus:border-transparent text-primary"})]})]}),(0,t.jsxs)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[v.map(e=>(0,t.jsx)(j.Zp,{className:"cursor-pointer transition-all duration-200 ".concat((null==m?void 0:m.id)===e.id?"border-faculty bg-faculty/10":"hover:border-faculty/50"),padding:"sm",onClick:()=>h(e),children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-faculty/20 rounded-full flex items-center justify-center",children:(0,t.jsx)(E.A,{className:"h-5 w-5 text-faculty"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h4",{className:"font-medium text-primary",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-secondary",children:e.email}),(0,t.jsx)("p",{className:"text-xs text-muted",children:e.department})]}),(null==m?void 0:m.id)===e.id&&(0,t.jsx)("div",{className:"w-5 h-5 bg-faculty rounded-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]})},e.id)),0===v.length&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(E.A,{className:"h-8 w-8 text-muted mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-secondary",children:"No faculty members found"})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-primary",children:"Access Duration"}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-2",children:["1","2","4","8"].map(e=>(0,t.jsxs)(j.$n,{variant:y===e?"primary":"ghost",size:"sm",onClick:()=>p(e),className:"flex items-center justify-center space-x-1",children:[(0,t.jsx)(u.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[e,"h"]})]},e))})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-primary",children:"Message (Optional)"}),(0,t.jsx)("textarea",{placeholder:"Add a note for the recipient...",value:f,onChange:e=>N(e.target.value),rows:3,className:"w-full px-4 py-3 bg-surface border border-default rounded-xl focus:ring-2 focus:ring-faculty focus:border-transparent text-primary resize-none"})]}),(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsx)(j.$n,{variant:"ghost",onClick:w,className:"flex-1",icon:(0,t.jsx)(C.A,{className:"h-4 w-4"}),children:"Cancel"}),(0,t.jsx)(j.$n,{variant:"primary",onClick:()=>{m&&(l({keyId:r.id,recipientId:m.id,duration:parseInt(y),message:f.trim(),timestamp:Date.now()}),a(),h(null),o(""),p("1"),N(""))},disabled:!m,className:"flex-1",icon:(0,t.jsx)(R.A,{className:"h-4 w-4"}),children:"Share Access"})]}),(0,t.jsx)(j.Zp,{variant:"info",padding:"sm",children:(0,t.jsxs)("div",{className:"text-sm space-y-2",children:[(0,t.jsx)("h4",{className:"font-medium text-primary",children:"Sharing Guidelines:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-secondary",children:[(0,t.jsx)("li",{children:"• Shared access is temporary and expires automatically"}),(0,t.jsx)("li",{children:"• You remain responsible for the key during shared access"}),(0,t.jsx)("li",{children:"• The recipient will receive a notification with access details"}),(0,t.jsx)("li",{children:"• You can revoke access at any time from your history"})]})]})})]})}):null},D=()=>{var e;let[s,a]=(0,i.useState)("keys"),[r,v]=(0,i.useState)(""),[w,b]=(0,i.useState)("all"),[A,E]=(0,i.useState)(!1),[C,R]=(0,i.useState)(null),[D,T]=(0,i.useState)(!1),[I,_]=(0,i.useState)(!1),O=(0,f.useRouter)(),{user:L}=(0,N.As)(),{notifications:K,unreadCount:M,markAsRead:P,markAllAsRead:z,deleteNotification:F}=(0,g.E$)(),[Y,$]=(0,i.useState)([]),[q,Q]=(0,i.useState)([]),[G,Z]=(0,i.useState)(!0),[J,U]=(0,i.useState)(null);(0,i.useEffect)(()=>{H(),V()},[]);let H=async()=>{try{let e=await fetch("/api/keys?type=my-keys");if(!e.ok)throw Error("Failed to fetch keys");let s=await e.json();$(s.keys||[])}catch(e){console.error("Error fetching my keys:",e),U("Failed to load your keys")}},V=async()=>{try{let e=await fetch("/api/keys?type=dept-keys");if(!e.ok)throw Error("Failed to fetch department keys");let s=await e.json();Q(s.keys||[]),Z(!1)}catch(e){console.error("Error fetching department keys:",e),U("Failed to load department keys"),Z(!1)}},W=[{id:"keys",label:"Keys",icon:(0,t.jsx)(n.A,{className:"h-5 w-5"}),badge:Y.filter(e=>e.isOverdue).length},{id:"deposit",label:"Deposit",icon:(0,t.jsx)(l.A,{className:"h-5 w-5"})},{id:"dept-keys",label:"Dept Keys",icon:(0,t.jsx)(c.A,{className:"h-5 w-5"})},{id:"history",label:"History",icon:(0,t.jsx)(o.A,{className:"h-5 w-5"})}],X=async e=>{try{let s=await fetch("/api/keys",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"generate-qr",keyId:e.id,data:{action:"collection"}})});if(!s.ok)throw Error("Failed to generate QR code");let a=await s.json();R({...e,qrData:a.qrData}),T(!0)}catch(e){console.error("Error generating QR code:",e)}},B=async e=>{try{if(!(await fetch("/api/keys/share",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"share-key",data:{keyId:C.id,keyName:C.keyName,labName:C.labName,recipientId:e.recipientId,recipientName:e.recipientName,duration:e.duration,message:e.message}})})).ok)throw Error("Failed to share key");H(),_(!1),R(null)}catch(e){console.error("Error sharing key:",e)}},ee=Y.filter(e=>{let s=e.keyName.toLowerCase().includes(r.toLowerCase())||e.labName.toLowerCase().includes(r.toLowerCase()),a="all"===w||e.accessType===w;return s&&a});return G?(0,t.jsx)("div",{className:"min-h-screen bg-background-secondary flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-faculty mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-secondary",children:"Loading your dashboard..."})]})}):J?(0,t.jsx)("div",{className:"min-h-screen bg-background-secondary flex items-center justify-center",children:(0,t.jsxs)(j.Zp,{className:"text-center p-8",children:[(0,t.jsx)("div",{className:"text-danger mb-4",children:"⚠️"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-primary mb-2",children:"Error Loading Dashboard"}),(0,t.jsx)("p",{className:"text-secondary mb-4",children:J}),(0,t.jsx)(j.$n,{onClick:()=>window.location.reload(),children:"Retry"})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-background-secondary pb-20",children:[(0,t.jsx)(j.Y9,{title:"Faculty Dashboard",showNotifications:!0,showProfile:!0,onNotificationClick:()=>{E(!0)},onProfileClick:()=>O.push("/profile"),className:"bg-surface border-b border-default",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 text-secondary"}),M>0&&(0,t.jsx)(j.vd,{count:M,size:"sm",className:"absolute -top-2 -right-2"})]}),(0,t.jsx)(j.UW,{})]})}),(0,t.jsx)("div",{className:"px-4 py-6 bg-faculty/5",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-faculty rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white font-semibold",children:(null==L||null==(e=L.name)?void 0:e.charAt(0))||"F"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-xl font-bold text-primary",children:["Welcome, ",(null==L?void 0:L.name)||"Faculty"]}),(0,t.jsx)("p",{className:"text-secondary",children:(null==L?void 0:L.department)||"Computer Science Department"})]})]})}),(0,t.jsx)("main",{className:"px-4 py-6",children:(()=>{switch(s){case"keys":default:return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex space-x-3",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted"}),(0,t.jsx)("input",{type:"text",placeholder:"Search keys...",value:r,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-surface border border-default rounded-xl focus:ring-2 focus:ring-faculty focus:border-transparent text-primary"})]}),(0,t.jsx)(j.$n,{variant:"all"!==w?"primary":"ghost",onClick:()=>b("all"===w?"permanent":"all"),icon:(0,t.jsx)(m.A,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"flex space-x-2",children:["all","permanent","temporary"].map(e=>(0,t.jsx)(j.$n,{variant:w===e?"primary":"ghost",size:"sm",onClick:()=>b(e),className:"capitalize",children:"all"===e?"All Keys":e},e))}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-4",children:ee.map(e=>(0,t.jsx)(j.Zp,{role:"faculty",className:"".concat(e.isOverdue?"border-l-4 border-l-danger":""),interactive:!0,children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-primary",children:e.keyName}),(0,t.jsx)(j.Ex,{variant:"permanent"===e.accessType?"success":"warning",size:"sm",children:e.accessType}),e.isOverdue&&(0,t.jsx)(j.Ex,{variant:"danger",size:"sm",children:"Overdue"})]}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-secondary",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(x.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:[e.labName," (",e.labNumber,")"]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(u.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["Last used: ",new Date(e.lastUsed).toLocaleDateString()]})]})]})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(j.$n,{variant:"ghost",size:"sm",onClick:()=>X(e),icon:(0,t.jsx)(h.A,{className:"h-4 w-4"})}),(0,t.jsx)(j.$n,{variant:"ghost",size:"sm",onClick:()=>{R(e),_(!0)},icon:(0,t.jsx)(y.A,{className:"h-4 w-4"})})]})]})},e.id))}),0===ee.length&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(n.A,{className:"h-12 w-12 text-muted mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-primary mb-2",children:"No keys found"}),(0,t.jsx)("p",{className:"text-secondary",children:r?"Try adjusting your search terms.":"You have no assigned keys."})]})]});case"deposit":return(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)(j.Zp,{role:"faculty",className:"text-center py-8",children:[(0,t.jsx)(l.A,{className:"h-12 w-12 text-faculty mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-primary mb-2",children:"Deposit Keys"}),(0,t.jsx)("p",{className:"text-secondary mb-6",children:"Generate QR code to deposit keys with security"}),(0,t.jsx)(j.$n,{variant:"primary",size:"lg",children:"Generate Deposit QR"})]})});case"dept-keys":return(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)("div",{className:"grid grid-cols-1 gap-4",children:q.map(e=>(0,t.jsx)(j.Zp,{role:"faculty",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-primary",children:e.keyName}),(0,t.jsx)("p",{className:"text-sm text-secondary",children:e.labName})]}),(0,t.jsx)(j.Ex,{variant:"available"===e.status?"success":"warning",children:"available"===e.status?"Available":"With ".concat(e.currentHolder)})]})},e.id))})});case"history":return(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)(j.Zp,{role:"faculty",className:"text-center py-8",children:[(0,t.jsx)(o.A,{className:"h-12 w-12 text-faculty mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-primary mb-2",children:"Key History"}),(0,t.jsx)("p",{className:"text-secondary",children:"View your key usage history and logs"})]})})}})()}),(0,t.jsx)(j.im,{items:W,activeItem:s,onItemClick:e=>{a(e.id)},variant:"faculty"}),(0,t.jsx)(j.vq,{isOpen:A,onClose:()=>E(!1),notifications:K,userRole:"faculty",onMarkAsRead:P,onMarkAllAsRead:z,onDeleteNotification:F}),D&&(0,t.jsx)(k,{isOpen:D,onClose:()=>{T(!1),R(null)},keyData:C,mode:"collection"}),I&&(0,t.jsx)(S,{isOpen:I,onClose:()=>{_(!1),R(null)},keyData:C,onShare:B})]})};function T(){return(0,t.jsx)(r.gX,{children:(0,t.jsx)(D,{})})}}},e=>{e.O(0,[96,826,358],()=>e(e.s=7567)),_N_E=e.O()}]);