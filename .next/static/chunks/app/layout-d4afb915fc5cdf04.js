(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2849:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var i=r(5155),a=r(2108),n=r(3169),o=r(6826),s=r(9130);function c(e){let{children:t}=e,{user:r}=(0,n.As)();return(0,i.jsx)(s.ph,{userRole:(null==r?void 0:r.role)||"faculty",children:t})}function l(e){let{children:t}=e;return(0,i.jsx)(a.SessionProvider,{children:(0,i.jsx)(o.NP,{children:(0,i.jsx)(n.OJ,{children:(0,i.jsx)(c,{children:(0,i.jsx)(o.tE,{children:t})})})})})}},8166:(e,t,r)=>{Promise.resolve().then(r.bind(r,9340)),Promise.resolve().then(r.bind(r,2849)),Promise.resolve().then(r.t.bind(r,4146,23)),Promise.resolve().then(r.t.bind(r,6686,23)),Promise.resolve().then(r.t.bind(r,9324,23))},9130:(e,t,r)=>{"use strict";r.d(t,{E$:()=>d,ph:()=>l});var i=r(5155),a=r(2115);let n=(0,a.createContext)(),o={KEY_OVERDUE:{type:"alert",priority:"high",roles:["faculty","hod","security_head"],autoExpire:!1},KEY_ASSIGNMENT:{type:"info",priority:"medium",roles:["faculty"],autoExpire:!0,expireAfter:864e5},KEY_DELEGATION:{type:"info",priority:"medium",roles:["faculty","hod"],autoExpire:!0,expireAfter:6048e5},SECURITY_ALERT:{type:"alert",priority:"high",roles:["security","security_head"],autoExpire:!1},SYSTEM_MAINTENANCE:{type:"warning",priority:"medium",roles:["faculty","security","hod","security_head"],autoExpire:!0,expireAfter:72e5},REPORT_READY:{type:"success",priority:"low",roles:["hod","security_head"],autoExpire:!0,expireAfter:6048e5}},s=(e,t)=>{switch(t.type){case"ADD_NOTIFICATION":return{...e,notifications:[t.payload,...e.notifications],unreadCount:e.unreadCount+1};case"MARK_AS_READ":return{...e,notifications:e.notifications.map(e=>e.id===t.payload?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)};case"MARK_ALL_AS_READ":return{...e,notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0};case"DELETE_NOTIFICATION":let r=e.notifications.find(e=>e.id===t.payload);return{...e,notifications:e.notifications.filter(e=>e.id!==t.payload),unreadCount:r&&!r.read?Math.max(0,e.unreadCount-1):e.unreadCount};case"CLEAR_EXPIRED":let i=Date.now(),a=e.notifications.filter(e=>!e.expiresAt||e.expiresAt>i),n=e.notifications.filter(e=>e.expiresAt&&e.expiresAt<=i&&!e.read).length;return{...e,notifications:a,unreadCount:Math.max(0,e.unreadCount-n)};case"SET_NOTIFICATIONS":let o=t.payload.filter(e=>!e.read).length;return{...e,notifications:t.payload,unreadCount:o};default:return e}},c={notifications:[],unreadCount:0},l=e=>{let{children:t,userRole:r}=e,[l,d]=(0,a.useReducer)(s,c);(0,a.useEffect)(()=>{let e=setInterval(()=>{d({type:"CLEAR_EXPIRED"})},6e4);return()=>clearInterval(e)},[]);let u=e=>{let t=o[e.notificationType]||{type:"info",priority:"medium",roles:["faculty","security","hod","security_head"],autoExpire:!1};if(!t.roles.includes(r))return;let i={id:"notif_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),title:e.title,message:e.message,type:t.type,priority:t.priority,category:e.category||"General",timestamp:new Date,read:!1,expiresAt:t.autoExpire?Date.now()+t.expireAfter:null,data:e.data||{}};d({type:"ADD_NOTIFICATION",payload:i}),"granted"===Notification.permission&&"high"===t.priority&&new Notification(i.title,{body:i.message,icon:"/VNRVJIETLOGO.png",tag:i.id})},p=async()=>"Notification"in window&&"default"===Notification.permission?"granted"===await Notification.requestPermission():"granted"===Notification.permission,h={notifications:l.notifications,unreadCount:l.unreadCount,addNotification:u,markAsRead:e=>{d({type:"MARK_AS_READ",payload:e})},markAllAsRead:()=>{d({type:"MARK_ALL_AS_READ"})},deleteNotification:e=>{d({type:"DELETE_NOTIFICATION",payload:e})},requestNotificationPermission:p,...{keyOverdueReminder:(e,t)=>u({notificationType:"KEY_OVERDUE",title:"Key Return Reminder",message:"".concat(e," is ").concat(t," day(s) overdue. Please return immediately."),category:"Key Management",data:{keyName:e,daysOverdue:t}}),keyAssigned:(e,t)=>u({notificationType:"KEY_ASSIGNMENT",title:"New Key Assignment",message:"You have been assigned access to ".concat(e," (").concat(t,")."),category:"Key Management",data:{keyName:e,labName:t}}),keyDelegated:(e,t,r)=>u({notificationType:"KEY_DELEGATION",title:"Key Access Shared",message:"".concat(t," has shared ").concat(e," access with you for ").concat(r,"."),category:"Key Sharing",data:{keyName:e,fromFaculty:t,duration:r}}),overdueAlert:(e,t,r)=>u({notificationType:"SECURITY_ALERT",title:"Overdue Key Alert",message:"".concat(e," is ").concat(r," day(s) overdue. Faculty: ").concat(t),category:"Security Alert",data:{keyName:e,facultyName:t,daysOverdue:r}}),departmentReport:(e,t)=>u({notificationType:"REPORT_READY",title:"Department Report Ready",message:"".concat(e," report for ").concat(t," is ready for review."),category:"Reports",data:{reportType:e,period:t}}),maintenanceAlert:(e,t)=>u({notificationType:"SYSTEM_MAINTENANCE",title:"Scheduled Maintenance",message:"System maintenance scheduled for ".concat(e,". Duration: ").concat(t,"."),category:"System",data:{startTime:e,duration:t}})}};return(0,i.jsx)(n.Provider,{value:h,children:t})},d=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useNotifications must be used within a NotificationProvider");return e}},9324:()=>{},9340:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var i=r(5155),a=r(2115),n=r(1243),o=r(3904),s=r(7340),c=r(6826);class l extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,errorId:Date.now().toString(36)+Math.random().toString(36).substr(2)}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({error:e,errorInfo:t}),this.reportError(e,t)}render(){if(this.state.hasError){let{error:e,errorInfo:t,errorId:r}=this.state;return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4",children:(0,i.jsx)(n.A,{className:"w-6 h-6 text-red-600"})}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Something went wrong"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"We're sorry, but something unexpected happened. Please try again or contact support if the problem persists."}),r&&(0,i.jsx)("div",{className:"bg-gray-100 rounded p-3 mb-4",children:(0,i.jsxs)("p",{className:"text-sm text-gray-600",children:["Error ID: ",(0,i.jsx)("code",{className:"font-mono",children:r})]})}),(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[(0,i.jsxs)(c.$n,{onClick:this.handleRetry,className:"flex items-center justify-center gap-2",children:[(0,i.jsx)(o.A,{className:"w-4 h-4"}),"Try Again"]}),(0,i.jsxs)(c.$n,{onClick:this.handleGoHome,variant:"outline",className:"flex items-center justify-center gap-2",children:[(0,i.jsx)(s.A,{className:"w-4 h-4"}),"Go Home"]})]}),!1]})]})})}return this.props.children}constructor(e){super(e),this.reportError=(e,t)=>{console.error("Error Report:",{message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,errorId:this.state.errorId})},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null,errorId:null})},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1,error:null,errorInfo:null,errorId:null}}}let d=l}},e=>{e.O(0,[1,96,826,358],()=>e(e.s=8166)),_N_E=e.O()}]);