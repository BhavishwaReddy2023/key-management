(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[98],{464:(e,s,t)=>{"use strict";t.d(s,{DD:()=>y,HP:()=>p,MJ:()=>x,gX:()=>m,hw:()=>h,qb:()=>u});var a=t(5155),i=t(2115),r=t(2108),n=t(5695),l=t(3169);let c=()=>(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}),o=e=>{let{requiredRole:s,userRole:t}=e;return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,a.jsx)("div",{className:"bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access this page."}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mb-6",children:[(0,a.jsxs)("p",{children:["Required role: ",(0,a.jsx)("span",{className:"font-semibold",children:Array.isArray(s)?s.join(" or "):s})]}),(0,a.jsxs)("p",{children:["Your role: ",(0,a.jsx)("span",{className:"font-semibold",children:t||"None"})]})]}),(0,a.jsx)("button",{onClick:()=>window.history.back(),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700 transition-colors",children:"Go Back"})]})})},d=e=>{let{children:s,requiredRole:t=null,requiredRoles:d=null,redirectTo:m="/login",fallback:x=null}=e,{data:u,status:h}=(0,r.useSession)(),{user:y,loading:p,hasRole:f,hasAnyRole:j}=(0,l.As)(),N=(0,n.useRouter)();if((0,i.useEffect)(()=>{if(console.log("\uD83D\uDEE1️ ProtectedRoute: Auth state check:",{session:!!u,status:h,loading:p,userRole:null==y?void 0:y.role,requiredRole:t,requiredRoles:d,userEmail:null==y?void 0:y.email}),"loading"===h||p)return void console.log("\uD83D\uDEE1️ ProtectedRoute: Still loading, waiting...");if(!u||!y){console.log("\uD83D\uDEE1️ ProtectedRoute: Not authenticated, redirecting to login"),N.push(m);return}return t&&(null==y?void 0:y.role)!==t?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for single role:",{userRole:null==y?void 0:y.role,requiredRole:t}):d&&!d.includes(null==y?void 0:y.role)?void console.log("\uD83D\uDEE1️ ProtectedRoute: Role check failed for multiple roles:",{userRole:null==y?void 0:y.role,requiredRoles:d,includes:d.includes(null==y?void 0:y.role)}):void console.log("\uD83D\uDEE1️ ProtectedRoute: All checks passed, rendering content")},[u,h,p,null==y?void 0:y.role,t,d,N,m]),"loading"===h||p)return x||(0,a.jsx)(c,{});if(!u||!y)return null;let v=d||t;return!v||(d?j(d):f(t))?s:(0,a.jsx)(o,{requiredRole:v,userRole:null==y?void 0:y.role})},m=e=>{let{children:s,...t}=e;return(0,a.jsx)(d,{requiredRoles:["faculty","hod"],...t,children:s})},x=e=>{let{children:s,...t}=e;return(0,a.jsx)(d,{requiredRoles:["security","security_head"],...t,children:s})},u=e=>{let{children:s,...t}=e;return(0,a.jsx)(d,{requiredRole:"security_head",...t,children:s})},h=e=>{let{children:s,...t}=e;return(0,a.jsx)(d,{requiredRole:"admin",...t,children:s})},y=e=>{let{children:s,...t}=e;return(0,a.jsx)(d,{requiredRole:"hod",...t,children:s})},p=e=>{let{children:s,...t}=e;return(0,a.jsx)(d,{...t,children:s})}},1190:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>N});var a=t(5155),i=t(464),r=t(2115),n=t(2713),l=t(7580),c=t(7434),o=t(2657),d=t(4616),m=t(1007),x=t(3717),u=t(8883),h=t(5695),y=t(6826),p=t(3169),f=t(9130);let j=()=>{var e;let[s,t]=(0,r.useState)("usage"),[i,j]=(0,r.useState)(!1),[N,v]=(0,r.useState)(null),[g,b]=(0,r.useState)(!1),A=(0,h.useRouter)(),{user:w}=(0,p.As)(),{notifications:E,unreadCount:R,markAsRead:D,markAllAsRead:_,deleteNotification:k}=(0,f.E$)(),[C,S]=(0,r.useState)({}),[T,I]=(0,r.useState)([]),[L,O]=(0,r.useState)([]),[K,M]=(0,r.useState)(!0),[P,Y]=(0,r.useState)(null);(0,r.useEffect)(()=>{z(),F()},[]);let z=async()=>{try{let e=await fetch("/api/hod/analytics?type=overview");if(!e.ok)throw Error("Failed to fetch analytics");let s=await e.json();S(s);let t=await fetch("/api/keys?type=all");if(t.ok){let e=await t.json();I(e.keys||[])}}catch(e){console.error("Error fetching analytics:",e),Y("Failed to load analytics data")}},F=async()=>{try{let e=await fetch("/api/hod/faculty");if(!e.ok)throw Error("Failed to fetch faculty data");let s=await e.json();O(s.faculty||[]),M(!1)}catch(e){console.error("Error fetching faculty data:",e),Y("Failed to load faculty data"),M(!1)}},U=[{id:"usage",label:"Usage",icon:(0,a.jsx)(n.A,{className:"h-5 w-5"})},{id:"access",label:"Access",icon:(0,a.jsx)(l.A,{className:"h-5 w-5"})},{id:"reports",label:"Reports",icon:(0,a.jsx)(c.A,{className:"h-5 w-5"})}],$=()=>{j(!0)};return K?(0,a.jsx)("div",{className:"min-h-screen bg-background-secondary flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-hod mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-secondary",children:"Loading HOD dashboard..."})]})}):P?(0,a.jsx)("div",{className:"min-h-screen bg-background-secondary flex items-center justify-center",children:(0,a.jsxs)(y.Zp,{className:"text-center p-8",children:[(0,a.jsx)("div",{className:"text-danger mb-4",children:"⚠️"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-primary mb-2",children:"Error Loading Dashboard"}),(0,a.jsx)("p",{className:"text-secondary mb-4",children:P}),(0,a.jsx)(y.$n,{onClick:()=>window.location.reload(),children:"Retry"})]})}):(E.filter(e=>!e.read).length,(0,a.jsxs)("div",{className:"min-h-screen bg-background-secondary pb-20",children:[(0,a.jsx)(y.Y9,{title:"HOD Dashboard",showNotifications:!0,showProfile:!0,onNotificationClick:$,onProfileClick:()=>A.push("/profile"),className:"bg-surface border-b border-default",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y.$n,{variant:"ghost",size:"sm",onClick:$}),R>0&&(0,a.jsx)(y.vd,{count:R,size:"sm",className:"absolute -top-2 -right-2"})]}),(0,a.jsx)(y.UW,{})]})}),(0,a.jsx)("div",{className:"px-4 py-6 bg-hod/5",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-hod rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-semibold",children:(null==w||null==(e=w.name)?void 0:e.charAt(0))||"H"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-xl font-bold text-primary",children:["Welcome, ",(null==w?void 0:w.name)||"HOD"]}),(0,a.jsxs)("p",{className:"text-secondary",children:[(null==w?void 0:w.department)||"Computer Science"," Department"]})]})]})}),(0,a.jsx)("main",{className:"px-4 py-6",children:(()=>{switch(s){case"usage":default:return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(y.Zp,{role:"hod",padding:"sm",className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-hod",children:C.totalKeys||0}),(0,a.jsx)("div",{className:"text-sm text-secondary",children:"Total Keys"})]}),(0,a.jsxs)(y.Zp,{role:"hod",padding:"sm",className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-warning",children:C.keysInUse||0}),(0,a.jsx)("div",{className:"text-sm text-secondary",children:"In Use"})]}),(0,a.jsxs)(y.Zp,{role:"hod",padding:"sm",className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-success",children:C.availableKeys||0}),(0,a.jsx)("div",{className:"text-sm text-secondary",children:"Available"})]}),(0,a.jsxs)(y.Zp,{role:"hod",padding:"sm",className:"text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-danger",children:C.overdueKeys||0}),(0,a.jsx)("div",{className:"text-sm text-secondary",children:"Overdue"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-primary",children:"Key Activity"}),T.map(e=>(0,a.jsx)(y.Zp,{role:"hod",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-primary",children:e.keyName}),(0,a.jsx)(y.Ex,{variant:(e=>{switch(e){case"in_use":return"warning";case"available":return"success";case"overdue":return"danger";default:return"default"}})(e.status),size:"sm",children:(e=>{switch(e){case"in_use":return"In Use";case"available":return"Available";case"overdue":return"Overdue";default:return e}})(e.status)})]}),(0,a.jsxs)("div",{className:"space-y-1 text-sm text-secondary",children:[(0,a.jsxs)("div",{children:["Lab: ",e.labNumber]}),e.currentHolder&&(0,a.jsxs)("div",{children:["Current holder: ",e.currentHolder]}),"in_use"===e.status&&e.dueDate&&(0,a.jsxs)("div",{children:["Due: ",new Date(e.dueDate).toLocaleDateString()]}),"available"===e.status&&e.lastUsed&&(0,a.jsxs)("div",{children:["Last used: ",new Date(e.lastUsed).toLocaleDateString()]}),(0,a.jsxs)("div",{children:["Usage: ",e.usageHours," hours this week"]})]})]}),(0,a.jsx)(y.$n,{variant:"ghost",size:"sm",icon:(0,a.jsx)(o.A,{className:"h-4 w-4"}),children:"Details"})]})},e.id))]})]});case"access":return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-primary",children:"Faculty Access Control"}),(0,a.jsx)("p",{className:"text-sm text-secondary",children:"Manage key access for department faculty"})]}),(0,a.jsx)(y.$n,{variant:"primary",size:"sm",icon:(0,a.jsx)(d.A,{className:"h-4 w-4"}),children:"Add Faculty"})]}),(0,a.jsx)("div",{className:"space-y-4",children:L.map(e=>(0,a.jsx)(y.Zp,{role:"hod",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-hod/20 rounded-full flex items-center justify-center",children:(0,a.jsx)(m.A,{className:"h-5 w-5 text-hod"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h4",{className:"font-semibold text-primary",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-secondary",children:e.email}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-2 text-xs text-muted",children:[(0,a.jsxs)("span",{children:["Access: ",e.accessLevel]}),(0,a.jsxs)("span",{children:["Keys: ",e.assignedKeys.length]}),(0,a.jsxs)("span",{children:["Last active: ",new Date(e.lastActive).toLocaleDateString()]})]}),e.assignedKeys.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-xs text-secondary mb-1",children:"Assigned Keys:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.assignedKeys.map(e=>(0,a.jsx)(y.Ex,{variant:"info",size:"sm",children:e},e))})]})]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(y.$n,{variant:"ghost",size:"sm",onClick:()=>{v(e),b(!0)},icon:(0,a.jsx)(x.A,{className:"h-4 w-4"})}),(0,a.jsx)(y.$n,{variant:"ghost",size:"sm",icon:(0,a.jsx)(u.A,{className:"h-4 w-4"})})]})]})},e.id))})]});case"reports":return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(y.Zp,{role:"hod",interactive:!0,className:"text-center py-8",children:[(0,a.jsx)(c.A,{className:"h-12 w-12 text-hod mx-auto mb-4"}),(0,a.jsx)("h3",{className:"font-semibold text-primary mb-2",children:"Daily Summary"}),(0,a.jsx)("p",{className:"text-sm text-secondary mb-4",children:"Today's key usage and activities"}),(0,a.jsx)(y.$n,{variant:"primary",size:"sm",children:"Generate Report"})]}),(0,a.jsxs)(y.Zp,{role:"hod",interactive:!0,className:"text-center py-8",children:[(0,a.jsx)(n.A,{className:"h-12 w-12 text-hod mx-auto mb-4"}),(0,a.jsx)("h3",{className:"font-semibold text-primary mb-2",children:"Weekly Analysis"}),(0,a.jsx)("p",{className:"text-sm text-secondary mb-4",children:"Comprehensive weekly usage patterns"}),(0,a.jsx)(y.$n,{variant:"primary",size:"sm",children:"View Analytics"})]}),(0,a.jsxs)(y.Zp,{role:"hod",interactive:!0,className:"text-center py-8",children:[(0,a.jsx)(u.A,{className:"h-12 w-12 text-hod mx-auto mb-4"}),(0,a.jsx)("h3",{className:"font-semibold text-primary mb-2",children:"Email Reports"}),(0,a.jsx)("p",{className:"text-sm text-secondary mb-4",children:"Configure automated email reports"}),(0,a.jsx)(y.$n,{variant:"primary",size:"sm",children:"Setup Email"})]}),(0,a.jsxs)(y.Zp,{role:"hod",interactive:!0,className:"text-center py-8",children:[(0,a.jsx)(l.A,{className:"h-12 w-12 text-hod mx-auto mb-4"}),(0,a.jsx)("h3",{className:"font-semibold text-primary mb-2",children:"Faculty Report"}),(0,a.jsx)("p",{className:"text-sm text-secondary mb-4",children:"Individual faculty usage summary"}),(0,a.jsx)(y.$n,{variant:"primary",size:"sm",children:"Generate Report"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-primary",children:"Recent Reports"}),(0,a.jsx)(y.Zp,{role:"hod",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-primary",children:"Weekly Usage Report"}),(0,a.jsxs)("p",{className:"text-sm text-secondary",children:["Generated on ",new Date().toLocaleDateString()]})]}),(0,a.jsx)(y.$n,{variant:"ghost",size:"sm",children:"Download"})]})})]})]})}})()}),(0,a.jsx)(y.im,{items:U,activeItem:s,onItemClick:e=>{t(e.id)},variant:"hod"}),(0,a.jsx)(y.vq,{isOpen:i,onClose:()=>j(!1),notifications:E,userRole:"hod",onMarkAsRead:D,onMarkAllAsRead:_,onDeleteNotification:k})]}))};function N(){return(0,a.jsx)(i.DD,{children:(0,a.jsx)(j,{})})}},2841:(e,s,t)=>{Promise.resolve().then(t.bind(t,1190))},9130:(e,s,t)=>{"use strict";t.d(s,{E$:()=>d,ph:()=>o});var a=t(5155),i=t(2115);let r=(0,i.createContext)(),n={KEY_OVERDUE:{type:"alert",priority:"high",roles:["faculty","hod","security_head"],autoExpire:!1},KEY_ASSIGNMENT:{type:"info",priority:"medium",roles:["faculty"],autoExpire:!0,expireAfter:864e5},KEY_DELEGATION:{type:"info",priority:"medium",roles:["faculty","hod"],autoExpire:!0,expireAfter:6048e5},SECURITY_ALERT:{type:"alert",priority:"high",roles:["security","security_head"],autoExpire:!1},SYSTEM_MAINTENANCE:{type:"warning",priority:"medium",roles:["faculty","security","hod","security_head"],autoExpire:!0,expireAfter:72e5},REPORT_READY:{type:"success",priority:"low",roles:["hod","security_head"],autoExpire:!0,expireAfter:6048e5}},l=(e,s)=>{switch(s.type){case"ADD_NOTIFICATION":return{...e,notifications:[s.payload,...e.notifications],unreadCount:e.unreadCount+1};case"MARK_AS_READ":return{...e,notifications:e.notifications.map(e=>e.id===s.payload?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)};case"MARK_ALL_AS_READ":return{...e,notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0};case"DELETE_NOTIFICATION":let t=e.notifications.find(e=>e.id===s.payload);return{...e,notifications:e.notifications.filter(e=>e.id!==s.payload),unreadCount:t&&!t.read?Math.max(0,e.unreadCount-1):e.unreadCount};case"CLEAR_EXPIRED":let a=Date.now(),i=e.notifications.filter(e=>!e.expiresAt||e.expiresAt>a),r=e.notifications.filter(e=>e.expiresAt&&e.expiresAt<=a&&!e.read).length;return{...e,notifications:i,unreadCount:Math.max(0,e.unreadCount-r)};case"SET_NOTIFICATIONS":let n=s.payload.filter(e=>!e.read).length;return{...e,notifications:s.payload,unreadCount:n};default:return e}},c={notifications:[],unreadCount:0},o=e=>{let{children:s,userRole:t}=e,[o,d]=(0,i.useReducer)(l,c);(0,i.useEffect)(()=>{let e=setInterval(()=>{d({type:"CLEAR_EXPIRED"})},6e4);return()=>clearInterval(e)},[]);let m=e=>{let s=n[e.notificationType]||{type:"info",priority:"medium",roles:["faculty","security","hod","security_head"],autoExpire:!1};if(!s.roles.includes(t))return;let a={id:"notif_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),title:e.title,message:e.message,type:s.type,priority:s.priority,category:e.category||"General",timestamp:new Date,read:!1,expiresAt:s.autoExpire?Date.now()+s.expireAfter:null,data:e.data||{}};d({type:"ADD_NOTIFICATION",payload:a}),"granted"===Notification.permission&&"high"===s.priority&&new Notification(a.title,{body:a.message,icon:"/VNRVJIETLOGO.png",tag:a.id})},x=async()=>"Notification"in window&&"default"===Notification.permission?"granted"===await Notification.requestPermission():"granted"===Notification.permission,u={notifications:o.notifications,unreadCount:o.unreadCount,addNotification:m,markAsRead:e=>{d({type:"MARK_AS_READ",payload:e})},markAllAsRead:()=>{d({type:"MARK_ALL_AS_READ"})},deleteNotification:e=>{d({type:"DELETE_NOTIFICATION",payload:e})},requestNotificationPermission:x,...{keyOverdueReminder:(e,s)=>m({notificationType:"KEY_OVERDUE",title:"Key Return Reminder",message:"".concat(e," is ").concat(s," day(s) overdue. Please return immediately."),category:"Key Management",data:{keyName:e,daysOverdue:s}}),keyAssigned:(e,s)=>m({notificationType:"KEY_ASSIGNMENT",title:"New Key Assignment",message:"You have been assigned access to ".concat(e," (").concat(s,")."),category:"Key Management",data:{keyName:e,labName:s}}),keyDelegated:(e,s,t)=>m({notificationType:"KEY_DELEGATION",title:"Key Access Shared",message:"".concat(s," has shared ").concat(e," access with you for ").concat(t,"."),category:"Key Sharing",data:{keyName:e,fromFaculty:s,duration:t}}),overdueAlert:(e,s,t)=>m({notificationType:"SECURITY_ALERT",title:"Overdue Key Alert",message:"".concat(e," is ").concat(t," day(s) overdue. Faculty: ").concat(s),category:"Security Alert",data:{keyName:e,facultyName:s,daysOverdue:t}}),departmentReport:(e,s)=>m({notificationType:"REPORT_READY",title:"Department Report Ready",message:"".concat(e," report for ").concat(s," is ready for review."),category:"Reports",data:{reportType:e,period:s}}),maintenanceAlert:(e,s)=>m({notificationType:"SYSTEM_MAINTENANCE",title:"Scheduled Maintenance",message:"System maintenance scheduled for ".concat(e,". Duration: ").concat(s,"."),category:"System",data:{startTime:e,duration:s}})}};return(0,a.jsx)(r.Provider,{value:u,children:s})},d=()=>{let e=(0,i.useContext)(r);if(!e)throw Error("useNotifications must be used within a NotificationProvider");return e}}},e=>{e.O(0,[96,826,358],()=>e(e.s=2841)),_N_E=e.O()}]);